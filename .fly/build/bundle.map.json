{"version":3,"sources":["webpack:///webpack/bootstrap e81c7fb1dc75d99b87828187fddb6c238391e037","webpack:///./index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","corsHeaders","headers","Access-Control-Allow-Headers","Access-Control-Allow-Methods","Access-Control-Allow-Origin","fly","http","respondWith","async","req","url","URL","pathname","file","fetch","catch","e","Response","text","issuesResponse","username","repo","query","result","method","Authorization","Content-Type","User-Agent","body","JSON","stringify","console","error","json","getRepoIssues","searchParams","errors","map","message","promises","data","repository","issues","edges","issue","sentimentInfo","probability","getSentimentAnalysis","node","title","bodyText","then","sentiment","Promise","all","edge"],"mappings":"mBACA,IAAAA,oBAGA,SAAAC,oBAAAC,UAGA,GAAAF,iBAAAE,UACA,OAAAF,iBAAAE,UAAAC,QAGA,IAAAC,OAAAJ,iBAAAE,WACAG,EAAAH,SACAI,GAAA,EACAH,YAUA,OANAI,QAAAL,UAAAM,KAAAJ,OAAAD,QAAAC,cAAAD,QAAAF,qBAGAG,OAAAE,GAAA,EAGAF,OAAAD,QAKAF,oBAAAQ,EAAAF,QAGAN,oBAAAS,EAAAV,iBAGAC,oBAAAU,EAAA,SAAAR,QAAAS,KAAAC,QACAZ,oBAAAa,EAAAX,QAAAS,OACAG,OAAAC,eAAAb,QAAAS,MACAK,cAAA,EACAC,YAAA,EACAC,IAAAN,UAMAZ,oBAAAmB,EAAA,SAAAhB,QACA,IAAAS,OAAAT,eAAAiB,WACA,WAA2B,OAAAjB,OAAA,SAC3B,WAAiC,OAAAA,QAEjC,OADAH,oBAAAU,EAAAE,OAAA,IAAAA,QACAA,QAIAZ,oBAAAa,EAAA,SAAAQ,OAAAC,UAAsD,OAAAR,OAAAS,UAAAC,eAAAjB,KAAAc,OAAAC,WAGtDtB,oBAAAyB,EAAA,GAGAzB,wCAAA0B,EAAA,8BC7DA,MAAAC,aAAqBC,SACrBC,+BAAA,eACAC,+BAAA,MACAC,8BAAA,MAGAC,IAAAC,KAAAC,YAAAC,MAAAC,MACA,MAAAC,IAAA,IAAAC,IAAAF,IAAAC,KACA,kBAAAA,IAAAE,SAAA,CACA,IAAAC,WAAAC,MAAA,eAAAJ,IAAAE,SAAA,cAAAF,IAAAE,WACAG,MAAAC,GAAmB,IAAAC,SAAAD,IACnB,WAAAC,eAAAJ,KAAAK,QAEA,IACA,MAAAR,IAAA,IAAAC,IAAAF,IAAAC,KACA,IAAAS,qBAmBAX,eAAAY,SAAAC,MACA,MACAC,gDAE0BF,oBAAoBC,qYAsB9C,IAAAE,aAAAT,MAAA,kCACAU,OAAA,OACAvB,SAAcwB,cAAA,kDAAuCC,eAAA,mBAAAC,aAAA,YACrDC,KAAAC,KAAAC,WAA0BR,gBAE1BP,MAAAC,GAAAe,QAAAC,MAAAhB,IAEA,OADAO,oBAAAU,OAnDAC,CAAAxB,IAAAyB,aAAA5C,IAAA,QAAAmB,IAAAyB,aAAA5C,IAAA,SACA,GAAA4B,eAAAiB,OAUA,WAAAnB,SAAAY,KAAAC,WAA4CM,OAAAjB,eAAAiB,OAAAC,IAAAL,aAAAM,WAA0DtC,aAVtG,CACA,IAAAuC,SAAApB,eAAAqB,KAAAC,WAAAC,OAAAC,MAAAN,IAAAO,QAqDApC,eAAAU,MACA,IAAA2B,oBAAA/B,MAAA,6CACAU,OAAA,OACAI,KAAA,QAAAV,OAEAH,MAAAC,GAAAe,QAAAC,MAAAhB,IAGA,OADA6B,kCAAAZ,QACAa,aA5DAC,CAAAH,MAAAI,KAAAC,MAAA,KAAAL,MAAAI,KAAAE,UACAC,KAAA5B,SACAqB,MAAAI,KAAAI,UAAA7B,UAIA,aADA8B,QAAAC,IAAAf,UACA,IAAAtB,SAAAY,KAAAC,WAA4CY,OAAAvB,eAAAqB,KAAAC,WAAAC,OAAAC,MAAAN,IAAAkB,WAAAP,QAA2EhD,cAIlH,MAAAgB,GACL,WAAAC,SAAAY,KAAAC,WAA0CM,QAAApB,KAAYhB","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e81c7fb1dc75d99b87828187fddb6c238391e037","const corsHeaders = {headers: {\n  'Access-Control-Allow-Headers': 'Content-Type',\n  'Access-Control-Allow-Methods': 'GET',\n  'Access-Control-Allow-Origin': '*'\n}};\n\nfly.http.respondWith( async (req)=> {\n  const url = new URL(req.url); \n  if(url.pathname != '/api/issues'){\n    let file = await fetch('file:/' + (url.pathname == '/' ? '/index.html' : url.pathname))\n      .catch(e => {return new Response(e)});\n    return new Response(await file.text());\n  } else {\n    try {\n      const url = new URL(req.url);\n      let issuesResponse = await getRepoIssues(url.searchParams.get('user'), url.searchParams.get('repo'));\n      if(!issuesResponse.errors){\n        let promises = issuesResponse.data.repository.issues.edges.map(issue => \n          getSentimentAnalysis(issue.node.title + \". \" + issue.node.bodyText)\n            .then(result => {\n              issue.node.sentiment = result;\n            })\n        );\n        await Promise.all(promises);\n        return new Response(JSON.stringify({issues: issuesResponse.data.repository.issues.edges.map(edge => edge.node)}), corsHeaders)\n      } else {\n        return new Response(JSON.stringify({errors: issuesResponse.errors.map(error => error.message)}), corsHeaders)\n      }\n    } catch (e){\n      return new Response(JSON.stringify({errors: [e]}), corsHeaders)\n    }\n  }\n})\n\nasync function getRepoIssues(username, repo){\n  const accessToken = \"f0074d35b43bcc9785ec9d67092a4cf1e658ab4c\";\n  const query = `\n    query {\n      repository(owner:\"${username}\", name:\"${repo}\") {\n        issues(last:20, states:OPEN) {\n          edges {\n            node {\n              title\n              url\n              bodyText\n              url\n              author {\n                url\n                avatarUrl\n              }\n              createdAt\n              id\n              bodyHTML\n            } \n          }\n        }\n      }\n    }\n  `;\n\n  let result = await fetch('https://api.github.com/graphql', {\n    method: 'POST',\n    headers: {'Authorization': `Bearer ${accessToken}`, 'Content-Type': 'application/json', 'User-Agent': 'mikedane'},\n    body: JSON.stringify({ query: query }),\n  })\n  .catch(e => console.error(e));\n  result =  await result.json()\n  return result;\n}\n\nasync function getSentimentAnalysis(text){\n  let sentimentInfo = await fetch('http://text-processing.com/api/sentiment/', {\n    method: 'POST',\n    body: \"text=\" + text,\n  })\n  .catch(e => console.error(e));\n\n  sentimentInfo = await sentimentInfo.json();\n  return sentimentInfo.probability;\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./index.js\n// module id = 0\n// module chunks = 0"],"sourceRoot":""}